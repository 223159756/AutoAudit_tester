groups:
- name: container-health
  rules:
    # Service is unreachable (down) for over 5 minutes
    - alert: ServiceDown
      expr: up == 0
      for: 5m
      labels:
        severity: critical
        team: devops
      annotations:
        summary: "Service is unreachable"
        description: |
          The monitored service/job has been DOWN (no healthy targets) for over 5 minutes.

    # High average CPU usage for more than 10 minutes
    - alert: HighCPUUsage
      expr: avg by(instance)(rate(container_cpu_usage_seconds_total[5m])) > 0.9
      for: 10m
      labels:
        severity: warning
        team: devops
      annotations:
        summary: "High CPU usage"
        description: |
          Average CPU usage is above 90% for 10 minutes on {{ $labels.instance }}.

    # High average memory usage for more than 10 minutes
    - alert: HighMemoryUsage
      expr: avg by(instance)((container_memory_usage_bytes / container_spec_memory_limit_bytes) > 0.8) == 1
      for: 10m
      labels:
        severity: warning
        team: devops
      annotations:
        summary: "High Memory usage"
        description: |
          Average memory usage is above 80% for 10 minutes on {{ $labels.instance }}.